import urllib.request
import datetime
import os

from tqdm import tqdm


def download_nvd_history(d_path, from_year=2016):
    """Download the CVE-yyyy data feed from NVD as a zip file

    files are saved as ```yyyy.zip```

    args:
        d_path (str): directory path to store the download files.
        from_year (int): from year for downloading. Defaults to 2016.
    """
    now = datetime.datetime.now()

    for t in tqdm(list(range(from_year, int(now.year) + 1))):
        d_URL = "https://nvd.nist.gov/feeds/json/cve/1.1/nvdcve-1.1-"\
                + str(t) + ".json.zip"
        with urllib.request.urlopen(d_URL) as zip_file:
            data = zip_file.read()
            filename = os.path.join(d_path, os.path.basename(d_URL))
            with open(filename, mode='wb') as fd:
                fd.write(data)


def download_modified_nvd(d_path):
    """Download CVE-Modified data feed from NVD

    save as a ```nvdcve-1.1-modified.json.zip```

    args:
        d_path (str): directory path to store the download file.
    """
    d_URL = "https://nvd.nist.gov/feeds/json/cve/1.1/"\
            "nvdcve-1.1-modified.json.zip"

    with urllib.request.urlopen(d_URL) as zip_file:
        data = zip_file.read()
        filename = os.path.join(d_path, os.path.basename(d_URL))
        with open(filename, mode='wb') as fd:
            fd.write(data)
